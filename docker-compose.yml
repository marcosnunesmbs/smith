# Smith — Standalone Remote Agent for Morpheus
#
# Usage:
#   1. Copy .env.example to .env and fill in the values
#   2. Start:  docker compose up -d
#   3. Status: docker compose exec smith node bin/smith.js status
#   4. Logs:   docker compose logs -f smith

services:
  smith:
    build: .
    container_name: smith-agent
    restart: unless-stopped
    ports:
      - "${SMITH_PORT:-7900}:7900"
    volumes:
      # Persist logs and browser cache across restarts
      - smith-data:/root/.smith
      # Mount a workspace directory for Smith to operate on
      - ${SMITH_WORKSPACE:-./workspace}:/workspace
    environment:
      - SMITH_HOME=/root/.smith
      - NODE_ENV=production
      # ─── Required ───
      - SMITH_NAME=${SMITH_NAME:-smith}
      - SMITH_PORT=${SMITH_PORT:-7900}
      - SMITH_SANDBOX_DIR=${SMITH_SANDBOX_DIR:-/workspace}
      # ─── Auth (optional — auto-generated if omitted, use smith init to persist) ───
      - SMITH_AUTH_TOKEN=${SMITH_AUTH_TOKEN:-}
      # ─── Security (optional) ───
      - SMITH_READONLY_MODE=${SMITH_READONLY_MODE:-false}
      - SMITH_ENABLE_FILESYSTEM=${SMITH_ENABLE_FILESYSTEM:-true}
      - SMITH_ENABLE_SHELL=${SMITH_ENABLE_SHELL:-true}
      - SMITH_ENABLE_GIT=${SMITH_ENABLE_GIT:-true}
      - SMITH_ENABLE_NETWORK=${SMITH_ENABLE_NETWORK:-true}
      - SMITH_ALLOWED_SHELL_COMMANDS=${SMITH_ALLOWED_SHELL_COMMANDS:-}
      # ─── Tuning (optional) ───
      - SMITH_TIMEOUT_MS=${SMITH_TIMEOUT_MS:-30000}
      - SMITH_LOG_LEVEL=${SMITH_LOG_LEVEL:-info}

volumes:
  smith-data:
